
<!DOCTYPE html>
<html>
<head> <meta charset="utf-8"/> </head>
<body>

<div>

<video id="video_mse" > </video>

</div>

<script>


var assetURL = "testloop.mp4";

//# use correct mime/codecs or else Error is "source not open"...
var mimeCodec = 'video/mp4; codecs="avc1.42C01E"';

var mediaSource;

var video = document.getElementById( "video_mse" );



video.ontimeupdate = checkTime;

//# handle looping...
function checkTime() 
{
	if( video.currentTime == video.duration)
	{ 
		video.currentTime = 0; 
		video.play(); 
	}
  
}


if ( 'MediaSource' in window && MediaSource.isTypeSupported(mimeCodec) ) 
{
	mediaSource = new MediaSource;
	
	video.src = URL.createObjectURL(mediaSource);
	mediaSource.addEventListener('sourceopen', sourceOpen);
} 
else 
{ console.error('Unsupported MIME type or codec: ', mimeCodec); }

function sourceOpen (_) 
{
	//console.log(this.readyState); // open
	var mediaSource = this;
	var sourceBuffer = mediaSource.addSourceBuffer(mimeCodec);
	
	fetchAB(assetURL, function (buf) {
		sourceBuffer.addEventListener('updateend', function (_) {
		mediaSource.endOfStream();
		video.play();
	  });
	  
	  sourceBuffer.appendBuffer(buf);
	
	});
};

function fetchAB (url, callbackfunc ) 
{
	console.log("loading file: " + url);
	var xhr = new XMLHttpRequest;
	xhr.open('get', url);
	xhr.responseType = 'arraybuffer';
	xhr.onload = function() { callbackfunc( xhr.response ); }
	xhr.send();
}
	  
</script>
</body>
</html>

